{% extends "base.html" %}

{% block title %}Сброс пароля - Мессенджер{% endblock %}

{% block content %}
<div class="auth-wrapper">
    <div class="auth-container">
        <div class="logo">
            <div class="logo-icon">
                <svg width="64" height="64" viewBox="0 0 1024 1024">
                    <use xlink:href="#icon-chat"></use>
                </svg>
            </div>
            <h1>Сброс пароля</h1>
        </div>

        {% if error %}
        <div class="error-message">
            {{ error }}
        </div>
        {% endif %}

        <form method="POST" action="{{ url_for('reset_password', token=token) }}">
            <div class="form-group">
                <label>Новый пароль</label>
                <input type="password" name="new_password" id="new_password"
                       placeholder="Введите новый пароль" required minlength="8">
                <div style="font-size: 12px; color: var(--text-muted); margin-top: 5px;">
                    Пароль должен содержать минимум 8 символов
                </div>
            </div>

            <div class="form-group">
                <label>Подтвердите пароль</label>
                <input type="password" name="confirm_password" id="confirm_password"
                       placeholder="Подтвердите пароль" required minlength="8">
            </div>

            <div id="password_error" style="color: var(--danger); font-size: 13px; margin-bottom: 15px; display: none;">
                Пароли не совпадают
            </div>

            <button type="submit" class="btn btn-block" id="submit_btn">Сменить пароль</button>
        </form>

        <div style="text-align: center; margin-top: 20px;">
            <a href="{{ url_for('login') }}" style="color: var(--text-secondary); text-decoration: none; font-size: 14px;">
                ← Вернуться ко входу
            </a>
        </div>
    </div>
</div>

<script>
const newPass = document.getElementById('new_password');
const confirmPass = document.getElementById('confirm_password');
const errorDiv = document.getElementById('password_error');
const submitBtn = document.getElementById('submit_btn');

function checkPasswords() {
    if (confirmPass.value.length > 0) {
        if (newPass.value !== confirmPass.value) {
            errorDiv.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.5';
            submitBtn.style.cursor = 'not-allowed';
        } else {
            errorDiv.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor = 'pointer';
        }
    }
}

newPass.addEventListener('keyup', checkPasswords);
confirmPass.addEventListener('keyup', checkPasswords);
</script>
{% endblock %}
